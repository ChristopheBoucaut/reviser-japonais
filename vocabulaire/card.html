<!DOCTYPE html>
<html lang="fr" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Réviser le vocabulaire</title>
        <style media="screen">
            body {
                height: 100vh;
                margin: 0;
                display: grid;
                grid-template-rows: auto auto 1fr;
            }

            #board {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: 2fr auto auto;
                grid-template-areas:
                    "a a"
                    "b1 c1"
                    "b2 c2";
                text-align: center;
                align-items: center;
                border: 2px solid grey;
                position: relative;
            }

            #board > div:first-child {
                font-size: 100px;
            }

            #board > div:not(:first-child) {
                font-size: 50px;
                border: 2px solid grey;
                cursor: pointer;
                height: 100%;
                padding: 0;
            }

            #board > div:first-child {
                grid-area: a;
            }

            #score-good-anwser,
            #score-bad-anwser {
                padding: 4px;
                color: white;
                font-weight: bold;
                position: absolute;
                top: 0;
            }

            #score-good-anwser {
                background-color: green;
                left: 0;
            }

            #score-bad-anwser {
                background-color: red;
                right: 0;
            }
        </style>

        <script src="../js/utils.js" type="text/javascript"></script>
        <script src="../js/data/vocabulaire.js" type="text/javascript"></script>
    </head>
    <body>
        <a href="/index.html">&lt; Retour</a>

        <h1>Réviser le vocabulaire en mode carte</h1>

        <div id="board">
            <div></div>

            <div onclick="submitAnswer(this)"></div>
            <div onclick="submitAnswer(this)"></div>
            <div onclick="submitAnswer(this)"></div>
            <div onclick="submitAnswer(this)"></div>

            <span id="score-good-anwser">0</span>
            <span id="score-bad-anwser">0</span>
        </div>

        <script type="text/javascript">
            var words = Revision.utils.wordsToArray(Revision.wordsGroup);
            words = Revision.utils.shuffle(words);

            // On récupère les éléments HTML récurrents pour le jeu.
            var askEl = document.querySelector('#board div:first-child');
            var answersEls = document.querySelectorAll('#board div:not(:first-child)');
            var scoreGoodAnswerEl = document.querySelector('#score-good-anwser');
            var scoreBadAnswerEl = document.querySelector('#score-bad-anwser');

            // Les modes de question/reponses, correspond à la position dans les array de vocabulaire.
            var MODE_KANJI = 0;
            var MODE_KANA = 1;
            var MODE_TRAD = 2;

            // Les modes de réponses qui seront proposés.
            var anwserModes;
            // La bonne réponse.
            var goodAnwser;
            // Les réponses qui seront proposées.
            var anwsersWords;
            // Le score.
            var scoreGoodAnswer = 0;
            var scoreBadAnswer = 0;

            // Démarre le plateau.
            prepareBoard();

            /**
             * Détermine la bonne réponse, les mots proposés en même temps, les modes de questions et rempli le plateau avec.
             */
            function prepareBoard() {
                goodAnwser = words[Revision.utils.random(words.length)];

                var singleMode = false;
                anwserModes = [MODE_KANJI, MODE_KANA, MODE_TRAD];
                if (goodAnwser[0] == goodAnwser[1]) {
                    // Il n'y a pas de kanji.
                    singleMode = true;
                    anwserModes.shift();
                }

                // On mélange les modes et on détermine le mode qui sera la question.
                anwserModes = Revision.utils.shuffle(anwserModes);
                var askMode = anwserModes.shift();

                // On trouve les 3 autres réponses à proposer.
                anwsersWords = [goodAnwser];
                while (anwsersWords.length < 4) {
                    var answerWord = words[Revision.utils.random(words.length)];
                    var answersingleMode = answerWord[0] == answerWord[1];

                    if (singleMode != answersingleMode) {
                        continue;
                    }

                    if (anwsersWords.indexOf(answerWord) != -1) {
                        continue;
                    }

                    anwsersWords.push(answerWord);
                }

                askEl.innerHTML = goodAnwser[askMode];
                showAnswers();
            }

            /**
             * Randomise les réponses et les affiches pour le mode courant.
             */
            function showAnswers() {
                anwsersWords = Revision.utils.shuffle(anwsersWords);
                answersEls.forEach(function (anwserEl, i) {
                    anwserEl.innerHTML = anwsersWords[i][anwserModes[0]];
                });
            }

            /**
             * Vérifie la bonne ou mauvaise réponse de l'utilisateur et passe à la suite.
             *
             * @param {Object} el L'élément où il a cliqué.
             */
            function submitAnswer(el) {
                if (el.innerHTML != goodAnwser[anwserModes[0]]) {
                    scoreBadAnswer++;
                    scoreBadAnswerEl.innerHTML = scoreBadAnswer;
                    alert("La bonne réponse était : "+goodAnwser[anwserModes[0]]);
                } else {
                    scoreGoodAnswer++;
                    scoreGoodAnswerEl.innerHTML = scoreGoodAnswer;
                }
                // On actualise le score.

                // On passe au mode suivant.
                anwserModes.shift();

                if (anwserModes.length) {
                    // Reste encore des modes.
                    showAnswers();
                } else {
                    // Passe au mot suivant.
                    prepareBoard();
                }
            }
        </script>
    </body>
</html>
